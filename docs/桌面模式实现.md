# 普通窗口模式（默认）

## 功能说明

便签窗口默认使用**普通窗口模式**，窗口在正常层级，可以被其他窗口遮挡。用户可以通过点击📌按钮将便签置顶到最前面。

## 实现细节

### 1. 窗口层级

```
桌面
  ↓
普通窗口（便签默认）← 可以被遮挡
  ↓
置顶窗口（点击📌后）← 在所有窗口之上
```

### 2. 代码实现

**位置**: `electron/main.ts` - `createWindow` 函数

```typescript
// 如果是便签窗口，默认不设置置顶（普通模式）
// 普通模式：窗口保持在普通层级，会被其他窗口遮挡
// 用户可以通过📌按钮切换到置顶模式
if (options?.noteId) {
    // 默认不置顶，让窗口保持在普通层级
    window.setAlwaysOnTop(false)
    logger.debug(`便签窗口已设置为普通模式: ${window.id}`)
}
```

### 3. Electron API 说明

`window.setAlwaysOnTop(flag, level, relativeLevel)`

**参数**:
- `flag`: boolean - 是否置顶
- `level`: string - 窗口层级
  - `'normal'` - 普通窗口
  - `'floating'` - 浮动窗口（桌面模式）
  - `'torn-off-menu'` - 菜单级别
  - `'modal-panel'` - 模态面板
  - `'main-menu'` - 主菜单
  - `'status'` - 状态栏
  - `'pop-up-menu'` - 弹出菜单
  - `'screen-saver'` - 屏保级别

**我们的选择**: `'floating'`
- 在桌面之上
- 在普通窗口之下
- 适合桌面小部件类应用

## 用户体验

### 默认行为（普通模式）
1. 创建便签后，窗口显示在普通层级
2. 便签可以被其他窗口遮挡
3. 可以正常拖动、调整大小
4. 📌按钮显示为"未置顶"状态

### 点击📌按钮后（置顶模式）
1. 窗口提升到置顶层级
2. 在所有普通窗口之上
3. 适合需要特别关注的便签
4. 再次点击恢复到普通模式

### 关闭窗口
1. 点击×按钮关闭窗口
2. 便签数据保留
3. 从主窗口可以重新打开
4. 重新打开时恢复普通模式

## 使用场景

### 场景 1: 待办事项
- 便签始终显示在桌面上
- 工作时随时可见
- 不会被其他窗口遮挡

### 场景 2: 重要提醒
- 关键信息始终可见
- 不会忘记重要事项
- 类似桌面便签纸

### 场景 3: 参考资料
- 代码片段、命令等
- 随时查看参考
- 不需要切换窗口

### 场景 4: 临时笔记
- 快速记录想法
- 始终在视野范围内
- 方便随时补充

## 与传统置顶的区别

### 传统置顶（Always On Top）
- 在所有窗口之上
- 可能遮挡其他内容
- 需要手动开启

### 桌面模式（Desktop Mode）
- 在桌面层，普通窗口之下
- 不会遮挡工作窗口
- 默认开启，始终可见
- 更像桌面小部件

## 技术优势

### 1. 性能优化
- 使用系统原生 API
- 无需额外的窗口管理
- 低资源占用

### 2. 跨平台支持
- Windows: 完整支持
- macOS: 完整支持
- Linux: 完整支持

### 3. 用户体验
- 符合桌面便签的使用习惯
- 不干扰正常工作
- 始终可见但不突兀

## 配置选项

### 当前实现
- ✅ 默认桌面模式
- ✅ 可切换到超级置顶
- ✅ 保留在任务栏
- ✅ 可正常拖动和调整大小

### 未来可扩展
- [ ] 透明度调整
- [ ] 鼠标穿透模式
- [ ] 自动隐藏
- [ ] 边缘吸附

## 测试场景

### 测试 1: 默认桌面模式
1. 创建新便签
2. **预期**: 窗口显示在桌面上
3. **预期**: 📌按钮显示为"已置顶"状态
4. 打开其他应用窗口
5. **预期**: 便签仍然可见（在其他窗口下方）

### 测试 2: 切换到超级置顶
1. 打开便签窗口
2. 点击📌按钮
3. **预期**: 窗口提升到最高层级
4. 打开其他应用窗口
5. **预期**: 便签在所有窗口之上

### 测试 3: 恢复桌面模式
1. 便签处于超级置顶状态
2. 再次点击📌按钮
3. **预期**: 恢复到桌面模式
4. **预期**: 便签在普通窗口之下

### 测试 4: 重新打开便签
1. 关闭便签窗口
2. 从主窗口重新打开
3. **预期**: 恢复桌面模式
4. **预期**: 📌按钮显示正确状态

## 已知限制

### 1. 全屏应用
- 全屏应用会覆盖便签
- 这是系统行为，无法避免
- 退出全屏后便签恢复可见

### 2. 屏保和锁屏
- 屏保和锁屏会覆盖便签
- 这是正常的安全行为

### 3. 多显示器
- 便签只在创建时的显示器上
- 移动到其他显示器后仍然有效

## 相关文件

- `electron/main.ts` - 窗口创建和桌面模式设置
- `src/components/NoteWindow.vue` - 便签窗口组件
- `src/components/MainWindow.vue` - 主窗口组件

## 更新日志

### 2024-11-20
- ✅ 实现桌面模式
- ✅ 设置为默认模式
- ✅ 更新置顶按钮提示
- ✅ 自动检测置顶状态
- ✅ 移除普通模式

## 用户反馈

如果用户希望便签不要始终可见，可以：
1. 关闭便签窗口（数据保留）
2. 需要时从主窗口重新打开
3. 或者点击📌按钮切换置顶级别

## 总结

桌面模式让便签真正成为"桌面便签"，始终可见但不干扰工作。这是便签应用最自然的使用方式，符合用户对桌面便签的期望。
