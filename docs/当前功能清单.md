# 便利贴应用 - 当前功能清单

## 📋 核心功能

### 1. 便签管理

#### 1.1 创建便签
- **位置**: 主窗口工具栏
- **按钮**: "新建便利贴" (+)
- **功能**: 
  - 创建新的空白便签
  - 自动保存到本地存储
  - 自动打开便签窗口
  - 默认尺寸: 300x300

#### 1.2 编辑便签
- **位置**: 便签窗口
- **功能**:
  - 实时编辑便签内容
  - 自动保存（500ms 防抖）
  - 显示字符数统计
  - 显示保存状态（已保存/未保存）
  - 支持多行文本
  - 支持换行和空格

#### 1.3 删除便签
- **位置**: 主窗口便签卡片
- **按钮**: × (删除按钮)
- **功能**:
  - 删除确认提示
  - 自动关闭相关窗口
  - 从存储中移除数据

#### 1.4 显示便签到桌面
- **位置**: 主窗口便签卡片
- **按钮**: 📌 (显示按钮)
- **功能**:
  - 打开已关闭的便签窗口
  - 聚焦已打开的便签窗口
  - 恢复便签的位置和尺寸
  - 点击预览区域也可打开

### 2. 窗口管理

#### 2.1 主窗口
- **类型**: 有边框窗口（系统原生标题栏）
- **功能**:
  - 便签列表展示
  - 搜索便签
  - 创建新便签
  - 管理所有便签
  - 设置入口（待实现）

#### 2.2 便签窗口
- **类型**: 无边框窗口（自定义标题栏）
- **功能**:
  - 自定义标题栏（可拖拽）
  - 内容编辑区
  - 状态栏（字符数、保存状态）
  - 窗口控制按钮

#### 2.3 窗口拖拽
- **技术**: `-webkit-app-region: drag`
- **功能**:
  - 通过标题栏拖动窗口
  - 系统原生拖拽体验
  - 无闪烁、无卡顿
  - 按钮区域不可拖拽

#### 2.4 窗口置顶
- **位置**: 便签窗口标题栏
- **按钮**: 📌 (置顶按钮)
- **功能**:
  - 切换窗口置顶状态
  - 视觉反馈（旋转45度）
  - 保持在其他窗口上方

#### 2.5 窗口关闭
- **位置**: 便签窗口标题栏
- **按钮**: × (关闭按钮)
- **功能**:
  - 关闭便签窗口
  - 自动保存内容
  - 保存窗口状态（位置、尺寸）
  - 数据保留（不删除便签）

### 3. 数据持久化

#### 3.1 自动保存
- **触发条件**:
  - 内容变更后 500ms
  - 窗口关闭时
  - 失去焦点时
- **保存内容**:
  - 便签内容
  - 便签位置
  - 便签尺寸
  - 置顶状态
  - 时间戳

#### 3.2 本地存储
- **存储方式**: localStorage
- **存储键**: `sticky-notes-data`
- **数据格式**: JSON
- **包含内容**:
  - 所有便签数据
  - 应用设置
  - 窗口状态
  - 版本信息

#### 3.3 状态恢复
- **应用启动时**:
  - 加载所有便签数据
  - 显示便签列表
  - 不自动打开便签窗口
- **打开便签时**:
  - 恢复便签内容
  - 恢复窗口位置
  - 恢复窗口尺寸
  - 恢复置顶状态

### 4. 用户界面

#### 4.1 主窗口界面
- **工具栏**:
  - 新建便利贴按钮
  - 搜索输入框
  - 设置按钮
- **便签网格**:
  - 响应式网格布局
  - 自动适应窗口大小
  - 卡片式展示
- **便签卡片**:
  - 标题/内容预览
  - 显示按钮 (📌)
  - 删除按钮 (×)
  - 更新时间
  - 悬停效果

#### 4.2 便签窗口界面
- **自定义标题栏**:
  - 拖拽区域
  - 置顶按钮
  - 关闭按钮
  - 半透明背景
- **内容编辑区**:
  - 全屏编辑
  - 占位提示
  - 自动滚动
  - 自定义滚动条
- **状态栏**:
  - 字符数统计
  - 保存状态显示

#### 4.3 视觉设计
- **主窗口**:
  - 浅灰色背景 (#f5f5f5)
  - 白色卡片
  - 蓝色主题色 (#2196f3)
- **便签窗口**:
  - 渐变黄色背景
  - 半透明标题栏
  - 圆角设计
  - 阴影效果

### 5. 搜索功能

#### 5.1 实时搜索
- **位置**: 主窗口工具栏
- **功能**:
  - 搜索便签标题
  - 搜索便签内容
  - 实时过滤结果
  - 不区分大小写

#### 5.2 搜索反馈
- **有结果**: 显示匹配的便签
- **无结果**: 显示空状态提示

### 6. 系统集成

#### 6.1 平台支持
- **Windows**: 完整支持
- **macOS**: 完整支持
- **Linux**: 完整支持

#### 6.2 窗口管理
- **多窗口支持**: 最多 20 个窗口
- **窗口状态管理**: 自动保存和恢复
- **显示器适配**: 自动调整到屏幕范围内

#### 6.3 开发环境
- **热重载**: 代码更改自动刷新
- **开发者工具**: 默认关闭（可手动打开）
- **错误提示**: 详细的错误信息

## 🎨 交互特性

### 1. 拖拽交互
- 通过标题栏拖动窗口
- 系统原生拖拽体验
- 平滑流畅的移动

### 2. 悬停效果
- **便签卡片**: 阴影 + 上移
- **按钮**: 背景色变化 + 放大
- **输入框**: 边框高亮

### 3. 点击交互
- **单击卡片**: 打开便签
- **单击📌**: 显示到桌面
- **单击×**: 删除便签
- **事件冒泡控制**: 按钮点击不触发卡片点击

### 4. 视觉反馈
- **保存状态**: 已保存/未保存/保存失败
- **置顶状态**: 图标旋转 + 背景色
- **加载状态**: 加载动画
- **错误状态**: 错误提示

## 📊 数据管理

### 1. 便签数据结构
```typescript
interface Note {
    id: string              // 唯一标识
    title?: string          // 标题（可选）
    content: string         // 内容
    position: Position      // 位置 {x, y}
    size: Size             // 尺寸 {width, height}
    style: NoteStyle       // 样式
    createdAt: number      // 创建时间
    updatedAt: number      // 更新时间
    isPinned: boolean      // 是否置顶
}
```

### 2. 窗口状态结构
```typescript
interface WindowState {
    windowId: string
    noteId?: string
    position: {x, y}
    size: {width, height}
    isAlwaysOnTop: boolean
    isMinimized: boolean
    isFocused: boolean
    createdAt: number
    updatedAt: number
}
```

### 3. 应用设置
```typescript
interface AppSettings {
    theme: 'light' | 'dark' | 'auto'
    defaultNoteSize: Size
    defaultNotePosition: Position
    autoSave: boolean
    saveInterval: number
}
```

## 🔧 技术特性

### 1. 架构设计
- **主进程**: Electron 窗口管理
- **渲染进程**: Vue 3 + Pinia
- **进程通信**: IPC (Inter-Process Communication)
- **状态管理**: Pinia Store
- **类型安全**: TypeScript

### 2. 性能优化
- **防抖保存**: 500ms 延迟
- **懒加载**: 按需加载组件
- **虚拟滚动**: 大量便签时优化
- **内存管理**: 窗口关闭时清理资源

### 3. 错误处理
- **数据验证**: 加载时验证数据结构
- **错误恢复**: 加载失败使用默认值
- **用户提示**: 友好的错误提示
- **日志记录**: 详细的日志输出

## 🚀 待实现功能

### 1. 高优先级
- [ ] 设置界面
- [ ] 便签颜色自定义
- [ ] 字体大小调整
- [ ] 导出/导入功能

### 2. 中优先级
- [ ] 便签分类/标签
- [ ] 便签排序（按时间、标题等）
- [ ] 快捷键支持
- [ ] 托盘图标和菜单

### 3. 低优先级
- [ ] 便签模板
- [ ] 富文本编辑
- [ ] 图片插入
- [ ] 云同步
- [ ] 多语言支持

## 📝 使用说明

### 创建便签
1. 打开主窗口
2. 点击"新建便利贴"按钮
3. 在弹出的便签窗口中输入内容
4. 内容自动保存

### 管理便签
1. 在主窗口查看所有便签
2. 点击📌按钮显示便签到桌面
3. 点击×按钮删除便签
4. 使用搜索框查找便签

### 编辑便签
1. 点击便签卡片或📌按钮打开
2. 直接在窗口中编辑内容
3. 内容自动保存
4. 关闭窗口保留数据

### 窗口操作
1. 拖动标题栏移动窗口
2. 点击📌按钮切换置顶
3. 点击×按钮关闭窗口
4. 调整窗口大小（拖动边缘）

## 🐛 已知问题

### 已修复
- ✅ 窗口拖拽闪烁问题
- ✅ 按钮点击冲突问题
- ✅ 便签重新打开问题
- ✅ IPC 序列化错误
- ✅ 窗口状态恢复问题

### 待修复
- ⚠️ 多显示器支持需要测试
- ⚠️ 大量便签时性能优化
- ⚠️ 窗口位置边界检查

## 📚 相关文档

- [新架构方案](./新架构方案.md)
- [无标题栏方案](./无标题栏方案.md)
- [实施步骤](./实施步骤.md)
- [便签窗口重新打开修复](./便签窗口重新打开修复.md)
- [便签卡片显示按钮功能](./便签卡片显示按钮功能.md)
- [便签列表显示问题排查](./便签列表显示问题排查.md)
- [测试抖动修复](./测试抖动修复.md)
- [开发环境配置](./开发环境配置.md)
